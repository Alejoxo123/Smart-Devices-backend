# ğŸ–¥ï¸ SmartDevices API â€” Backend

Este proyecto corresponde al **mÃ³dulo Back-end** de la aplicaciÃ³n *Smart Devices*.  
Desarrollado con **Node.js**, **Express**, **Sequelize** y **MySQL**.  
Incluye autenticaciÃ³n JWT y control de acceso para el mÃ³dulo de administraciÃ³n.

---

## ğŸš€ Requisitos

- [Node.js](https://nodejs.org/) versiÃ³n 22.12 o superior  
- [MySQL](https://dev.mysql.com/) versiÃ³n 8.x  
- (Opcional) [Postman](https://www.postman.com/) para pruebas de API  

---

## âš™ï¸ ConfiguraciÃ³n inicial

1. Clona el repositorio:  
   ```bash
   git clone git@github.com:Alejoxo123/Smart-Devices.git
   cd backend/api
   ```

2. Instala dependencias:  
   ```bash
   npm install
   ```

3. Crea el archivo `.env` en `backend/api/.env` con lo siguiente:  

   ```dotenv
   DATABASE_URL=mysql://usuario:password@localhost:3306/smart_devices
   JWT_SECRET=clave_secreta_segura
   PORT=3000
   ALLOWED_ORIGIN=http://localhost:4200
   ```

---

## ğŸ—„ï¸ Base de datos

En la carpeta `database/` se incluyen diagrama y dump SQL:

- `dump-smart_devices-202509221623.sql` â†’ Crea tablas relaciones y data inicial.  


Ejecuta:

```bash
mysql -u root -p -e "CREATE DATABASE IF NOT EXISTS smart_devices CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;"
mysql -u root -p smart_devices < database/create_schema.sql
```

---

## â–¶ï¸ EjecuciÃ³n del servidor

```bash
npm run dev
```

- Servidor en: `http://localhost:3000`  
- Healthcheck: `http://localhost:3000/health` â†’ `{ "ok": true }`

---

## ğŸ‘¤ AutenticaciÃ³n

### Registrar admin
```bash
curl -X POST http://localhost:3000/api/auth/register   -H "Content-Type: application/json"   -d '{"name":"admin","email":"admin@example.com","password":"admin123","role":"admin"}'
```

### Login
```bash
curl -X POST http://localhost:3000/api/auth/login   -H "Content-Type: application/json"   -d '{"email":"admin@example.com","password":"admin123"}'
```

Esto devuelve un token JWT que se debe incluir en el header:  
```
Authorization: Bearer <token>
```

---

## ğŸ“‚ Estructura del proyecto

```
backend/api/
 â”œâ”€â”€ src/
 â”‚   â”œâ”€â”€ server.js          # Punto de entrada
 â”‚   â”œâ”€â”€ app.js             # ConfiguraciÃ³n Express
 â”‚   â”œâ”€â”€ routes/            # DefiniciÃ³n de rutas
 â”‚   â”œâ”€â”€ controllers/       # Controladores de negocio
 â”‚   â”œâ”€â”€ middlewares/       # AutenticaciÃ³n / Errores
 â”‚   â”œâ”€â”€ db/                # ConfiguraciÃ³n Sequelize + modelos
 â”‚   â””â”€â”€ utils/             # Utilidades
 â””â”€â”€ database/              # Scripts SQL
```

---

## ğŸ”— Endpoints principales

### ğŸ”‘ AutenticaciÃ³n
- `POST /api/auth/register` â†’ Registrar usuario  
- `POST /api/auth/login` â†’ Iniciar sesiÃ³n  

### ğŸ·ï¸ Marcas
- `GET /api/brands` â†’ Listar  
- `POST /api/brands` â†’ Crear (admin)  
- `PUT /api/brands/:id` â†’ Actualizar (admin)  
- `DELETE /api/brands/:id` â†’ Eliminar (admin)  

### ğŸ“‚ CategorÃ­as
- `GET /api/categories` â†’ Listar  
- `POST /api/categories` â†’ Crear (admin)  
- `PUT /api/categories/:id` â†’ Actualizar (admin)  
- `DELETE /api/categories/:id` â†’ Eliminar (admin)  

### ğŸ“± Dispositivos
- `GET /api/devices` â†’ Listar (filtros: marca, categorÃ­a, bÃºsqueda, orden, paginaciÃ³n)  
- `GET /api/devices/:id` â†’ Detalle  
- `POST /api/devices` â†’ Crear (admin)  
- `PUT /api/devices/:id` â†’ Actualizar (admin)  
- `DELETE /api/devices/:id` â†’ Eliminar (admin)  

### ğŸ–¼ï¸ ImÃ¡genes
- `GET /api/images?deviceId=...` â†’ Listar por dispositivo  
- `POST /api/images` â†’ Subir imagen de dispositivo (admin)  

### ğŸ·ï¸ Tags
- `GET /api/tags` â†’ Listar  
- `POST /api/tags` â†’ Crear (admin)  
- `POST /api/tags/:id/devices/:deviceId` â†’ Asociar a un dispositivo  

### ğŸ’¬ Comentarios
- `GET /api/comments?deviceId=...` â†’ Listar  
- `POST /api/comments` â†’ Crear comentario  

---

## ğŸ“‹ Notas

- Middleware `requireAuth` â†’ protege rutas privadas.  
- Middleware `requireAdmin` â†’ solo accesible para admins.  
- Respuestas de error siguen formato:  

```json
{ "error": "Mensaje explicativo" }
```

CÃ³digos mÃ¡s comunes:  
`400` datos invÃ¡lidos Â· `401` no autenticado Â· `403` sin permisos Â· `404` no encontrado Â· `500` error interno.  

---

## ğŸ¤ ContribuciÃ³n

1. Haz un fork del repositorio.  
2. Crea una rama para tu cambio:  
   ```bash
   git checkout -b feature/nueva-funcionalidad
   ```
3. Realiza commits descriptivos.  
4. Abre un Pull Request en GitHub.  

---
